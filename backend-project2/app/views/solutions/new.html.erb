<div class="grid-Container">
  <div class="challenge-info">
    <h2><%= @challenge.name %></h2>
    <p><%= @challenge.description %></p>
  </div>
  <div class="ins-n-outs">
    <h3></h3>
  </div>
  <div class="code-textarea">
    <%= render partial: 'form' %>
  </div>
  <div class="errors">
    <button type="button" name="button" onClick='on_click()'>Test Code</button>
    <div></div>
  </div>
</div>

<script>
  let editor;
  $(document).ready(function(){
    let myTextArea = $('.codearea')[0];
    editor = CodeMirror.fromTextArea( myTextArea, {
      value: myTextArea.value,
      theme: 'neat',
      lineNumbers: true,});
      let funk;
  });

  const on_click = () => {
    let js = editor.getValue();
    let s = document.createElement('script');
    s.textContent = `funk = str => {
      ${js}
    }`;
    document.body.appendChild(s);
    try {
      funk("hello world");
    } catch (error){
      line = error.stack.split(':')[2];
      line = parseInt(line)-1;
      console.log(line);
      $('.errors div').text(`${error.message}. Best guess: line ${line}`)
    }
    s.remove()
  }

</script>
